(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),e.addEventListener("click",o),document.addEventListener("keydown",r)}function t(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",o),document.removeEventListener("keydown",r)}function n(){var t=cardPopup.querySelector(".popup__form"),n=t.querySelector(".popup__button");cardNameInput.value="",cardLinkInput.value="",cardNameInput.classList.remove("popup__input_wrong_value"),cardLinkInput.classList.remove("popup__input_wrong_value"),n.setAttribute("disabled",!0),n.classList.add("popup__button_disabled"),t.querySelectorAll(".error-message").forEach((function(e){return e.textContent=""})),e(cardPopup)}function o(e){e.target===e.currentTarget&&t(e.target)}function r(e){if("Escape"===e.key){var n=document.querySelector(".popup_is-opened");n&&t(n)}}function i(){var e=document.querySelector(".popup_type_edit").querySelector(".popup__form"),t=e.querySelector(".popup__button"),n=e.querySelector(".popup__input_type_name"),o=e.querySelector(".popup__input_type_description"),r=n.nextElementSibling,i=o.nextElementSibling;n.validity.valueMissing?r.textContent='Поле "Имя" должно быть заполнено.':n.validity.tooShort?r.textContent="Имя должно быть не менее 2 символов.":n.validity.tooLong?r.textContent="Имя должно быть не более 50 символов.":r.textContent="",o.validity.valueMissing?i.textContent='Поле "Занятие" должно быть заполнено.':o.validity.tooShort?i.textContent="Занятие должно быть не менее 2 символов.":o.validity.tooLong?i.textContent="Занятие должно быть не более 200 символов.":i.textContent="";var u=n.validity.valid,c=o.validity.valid;u&&c?(t.removeAttribute("disabled"),t.classList.remove("popup__button_disabled"),n.classList.remove("popup__input_wrong_value"),o.classList.remove("popup__input_wrong_value")):u?(t.setAttribute("disabled",!0),t.classList.add("popup__button_disabled"),n.classList.remove("popup__input_wrong_value"),o.classList.add("popup__input_wrong_value")):c?(t.setAttribute("disabled",!0),t.classList.add("popup__button_disabled"),n.classList.add("popup__input_wrong_value"),o.classList.remove("popup__input_wrong_value")):(t.setAttribute("disabled",!0),t.classList.add("popup__button_disabled"),n.classList.add("popup__input_wrong_value"),o.classList.add("popup__input_wrong_value"))}function u(){var e=document.querySelector(".popup_type_new-card").querySelector(".popup__form"),t=e.querySelector(".popup__button"),n=e.querySelector(".popup__input_type_card-name"),o=e.querySelector(".popup__input_type_url"),r=n.nextElementSibling,i=o.nextElementSibling,u=n.validity.valid,c=o.validity.valid;n.validity.valueMissing?r.textContent='Поле "Название" должно быть заполнено.':n.validity.tooShort?r.textContent="Название должно быть не менее 2 символов.":n.validity.tooLong?r.textContent="Название должно быть не более 30 символов.":r.textContent="",o.validity.valueMissing?i.textContent='Поле "Ссылка на картинку" должно быть заполнено.':o.validity.typeMismatch?i.textContent="Введите корректный URL.":i.textContent="",u&&c?(t.removeAttribute("disabled"),t.classList.remove("popup__button_disabled")):(t.setAttribute("disabled",!0),t.classList.add("popup__button_disabled")),n.classList.toggle("popup__input_wrong_value",!u),o.classList.toggle("popup__input_wrong_value",!c)}var c,a={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"4d0240ed-c777-4871-b34f-6c2246990198","Content-Type":"application/json"}},p=document.querySelector(".places__list"),l=document.querySelector(".popup_type_edit"),s=document.querySelector(".popup_type_new-card"),d=document.querySelector(".popup_type_image"),_=document.querySelector(".profile__edit-button"),v=l.querySelector(".popup__form"),y=v.querySelector(".popup__input_type_name"),f=v.querySelector(".popup__input_type_description"),m=document.querySelector(".popup__close"),b=s.querySelector(".popup__form"),h=document.querySelector(".profile__add-button"),S=s.querySelector(".popup__close"),L=d.querySelector(".popup__close"),q=b.querySelector(".popup__input_type_card-name"),g=b.querySelector(".popup__input_type_url"),E=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),x=document.querySelector(".popup_type_avatar"),C=x.querySelector(".popup__form"),w=C.querySelector(".popup__input_type_avatar-link"),j=x.querySelector(".popup__close"),U=document.querySelector(".profile__image-container"),A=document.querySelector(".profile__image");function P(t){var n=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),o=n.querySelector(".card__description"),r=o.querySelector(".card__title"),i=n.querySelector(".card__image"),u=n.querySelector(".card__delete-button"),p=o.querySelector(".card__like-button"),l=o.querySelector(".card__likes-counter"),s=document.querySelector(".popup_type_image"),d=s.querySelector(".popup__image"),_=s.querySelector(".popup__caption");r.textContent=t.name,i.src=t.link,i.alt=t.name;var v=t.likes?t.likes.length:0;return l.textContent=v,t.owner&&t.owner._id!==c?u.style.display="none":u.addEventListener("click",(function(){return function(e,t){(function(e){return fetch("".concat(a.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))})(e).then((function(){t.remove()})).catch((function(e){console.error("Error deleting card:",e)}))}(t._id,n)})),i.addEventListener("click",(function(){d.src=i.src,d.alt=i.alt,_.textContent=r.textContent,e(s)})),t.likes.some((function(e){return e._id===c}))&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(function(){var e;p.classList.contains("card__like-button_is-active")?(e=t._id,fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.json()}))).then((function(e){p.classList.remove("card__like-button_is-active"),l.textContent=e.likes.length})).catch((function(e){return console.error("Error unliking card:",e)})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then((function(e){return e.json()}))}(t._id).then((function(e){p.classList.add("card__like-button_is-active"),l.textContent=e.likes.length})).catch((function(e){return console.error("Error liking card:",e)}))})),n}function T(e,t){t?(e.textContent="Сохранение...",e.disabled=!0):(e.textContent="Сохранить",e.disabled=!1)}fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.json()})).then((function(e){E.textContent=e.name,k.textContent=e.about,A.style.backgroundImage="url(".concat(e.avatar,")"),c=e._id})).catch((function(e){console.error("Error fetching user info:",e)})),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.json()})).then((function(e){!function(e){e.forEach((function(e){var t=P(e);p.appendChild(t)}))}(e)})).catch((function(e){console.error("Error fetching cards:",e)})),l.classList.add("popup_is-animated"),s.classList.add("popup_is-animated"),d.classList.add("popup_is-animated"),L.addEventListener("click",(function(){t(d)})),v.addEventListener("submit",(function(e){e.preventDefault();var n=v.querySelector(".popup__button");T(n,!0);var o,r,i=y.value,u=f.value,c=document.querySelector(".profile__title"),p=document.querySelector(".profile__description");c.textContent=i,p.textContent=u,(o=i,r=u,fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:o,about:r})})).then((function(){t(l)})).catch((function(e){console.error("Error updating profile:",e)})).finally((function(){T(n,!1)}))})),b.addEventListener("submit",(function(e){e.preventDefault();var n,o=b.querySelector(".popup__button");T(o,!0),(n={name:q.value,link:g.value},fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:n.name,link:n.link})})).then((function(e){return e.json()})).then((function(e){var n=P(e);document.querySelector(".places__list").prepend(n),t(s)})).catch((function(e){console.error("Error creating new card:",e)})).finally((function(){T(o,!1)}))})),_.addEventListener("click",(function(){return e(l)})),m.addEventListener("click",(function(){return t(l)})),h.addEventListener("click",(function(){return e(s)})),S.addEventListener("click",(function(){return t(s)})),h.addEventListener("click",(function(){return n})),y.addEventListener("input",i),f.addEventListener("input",i),_.addEventListener("click",(function(){y.value=document.querySelector(".profile__title").textContent,f.value=document.querySelector(".profile__description").textContent,i(),e(l)})),q.addEventListener("input",u),g.addEventListener("input",u),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",o)})),U.addEventListener("click",(function(){return e(x)})),j.addEventListener("click",(function(){return t(x)})),C.addEventListener("submit",(function(e){e.preventDefault();var n,o=C.querySelector(".popup__button");T(o,!0),(n=w.value,fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))).then((function(e){A.style.backgroundImage="url(".concat(e.avatar,")"),t(x)})).catch((function(e){console.error("Error updating avatar:",e)})).finally((function(){T(o,!1)}))})),w.addEventListener("input",(function(){var e=document.querySelector(".popup_type_avatar").querySelector(".popup__form"),t=e.querySelector(".popup__input_type_avatar-link"),n=e.querySelector(".popup__button"),o=t.nextElementSibling;t.validity.valid?(o.textContent="",n.classList.remove("popup__button_disabled"),n.disabled=!1):(t.validity.valueMissing?o.textContent='Поле "Ссылка на картинку" должно быть заполнено.':t.validity.typeMismatch?o.textContent="Введите корректный URL.":o.textContent="",n.classList.add("popup__button_disabled"),n.disabled=!0)}))})();